# Project To-Do List

- [x] ~~**Database:** Apply migrations to add `status` and `preview_deployment_url` columns to `clients` table and create `site_settings` table.~~
- [x] ~~**Workflow:** Test the preview deployment workflow:~~
    - [x] ~~Add an external preview URL (e.g., Vercel) to a project via `/admin/projects`.~~
    - [x] ~~Verify the "Next (1-4 Weeks)" iframe on `/projects/[slug]` loads this URL correctly.~~
    - [x] ~~Verify the "Now (Live)" iframe on `/projects/[slug]` still loads the `website` URL.~~\n- [x] ~~**Cleanup:** Remove the `/previews/*` route and related files (`app/previews/layout.tsx`, `app/previews/[slug]/page.tsx`).~~
- [x] ~~**Git:** Resolve the Git push issue (local branch behind remote). Fetch/pull from `origin main` and then push.~~\n- [x] ~~**Bug:** Investigate and fix the "Invalid <Link> with <a> child" error (Checked `/projects/[slug]` page - Link is correct there. Monitor if error reappears elsewhere).~~ - **RESOLVED** Feature duplication issue fixed.
- [ ] **Google Sheets Integration:** Debug the `POST /api/google/export-transactions` 401 "invalid_grant" error. This might be related to OAuth scope changes or token issues.
- [-] **Team Page - Add New Member Dropdown:** ~~Investigate why the user selection dropdown in the "Add New Member" form on `/team` is appearing empty despite users being present in the `profiles` table (e.g., `ninjapunkgirls`). Check data fetching in `fetchPlatformUsers` and the rendering logic in `app/team/page.tsx`.~~ (Verify if recent /team page overhaul resolved this. If not, re-evaluate priority).

# Critical Unresolved Bugs
- [ ] **`/teams/join` Page Failure (PGRST200):**
    - [ ] **Symptom:** Page shows "Oops! Something went wrong. Could not load teams."
    - [ ] **Error:** Console shows `PGRST200` - "Could not find a relationship between 'teams' and 'created_by' in the schema cache" despite FK `teams_created_by_fkey` on `public.teams.created_by` referencing `auth.users(id)` being verified, and multiple attempts to refresh schema cache (NOTIFY, RLS touch, FK drop/re-add).
    - [ ] **Status:** Persistently blocked. Requires fresh investigation or alternative approaches.
- [ ] **`/projects/join` Page Failure:**
    - [ ] **Symptom:** Page shows "Oops! Something went wrong. Could not load available projects. Please ensure RLS policies on "clients" and "profiles" allow reads."
    - [ ] **Error:** Suggests RLS issues on `public.clients` or `public.profiles`, or issues with the data fetching query.
    - [ ] **UI Bug:** Page also displays a double navigation bar.
- [ ] **Avatar Display Instability:**
    - [ ] Sidebar avatar sometimes shows Google default instead of uploaded custom avatar, or there's a flicker.
    - [ ] Ensure consistent and stable display of the correct user avatar across all components (Sidebar, Profile Page, Chat, etc.) after login and avatar updates.

# New Feature Requests & Enhancements

## User & Team Management
- [x] ~~**Profile Pictures:** Implement profile picture upload, storage (e.g., Supabase Storage), and display for users.~~ (Core functionality implemented, see "Avatar Display Instability" bug above)
- [-] **"Start a New Project" from Profile Page:**
    - [x] ~~Add a prominent "Start a New Project" button/CTA on the user's profile page (`/profile`), especially visible if they have no existing projects.~~
    - [x] ~~This button should lead to a new page/form (e.g., `/projects/new`).~~
    - [ ] The form should allow users to define their project, including:
        - Project Name/Title.
        - Project Type (e.g., dropdown: Website, Mobile App, Software, Book, AI Solution, Other/Anything).
        - A description field to articulate their ideas, needs, and desired features.
    - [ ] Upon submission, this should create a new entry in the `public.clients` table (or your equivalent projects table) and associate it with the user (e.g., in `public.project_users` as the client or owner).
- [-] **Profile Page Action Buttons:**
    - [x] ~~Add "Join A Team" button to profile page (linking to `/teams/join`).~~
    - [x] ~~Add "Start New Team" button to profile page (linking to `/teams/new`).~~
    - [-] Add "Join A Project" button to profile page (linking to `/projects/join`). <!-- Page created, but has loading/RLS errors and UI bugs. See "Critical Unresolved Bugs". -->
- [ ] **Team Functionality - Phase 1 (DB Setup & Initial Page):**
    - [x] ~~Database Schema: `teams` and `user_team_memberships` tables with RLS.~~
    - [x] ~~Seed `teams` table with initial data (including "Database Divas").~~
    - [-] ~~Update `/teams/join` page to fetch from DB.~~ <!-- Page created but critically broken. See "Critical Unresolved Bugs". -->
- [ ] **Team Functionality - Phase 2: Dynamic Team Pages & Join Logic**
    - [ ] Create dynamic route `app/teams/[teamSlug]/page.tsx`.
    - [ ] Display team details and member list on `app/teams/[teamSlug]/page.tsx`.
    - [ ] Implement actual "Join Team" functionality on `/teams/join` (inserts into `user_team_memberships`) - **BLOCKED by `/teams/join` page failure.**
    - [ ] Implement "Leave Team" functionality.
- [ ] **Team Functionality - Phase 3: Profile Team Badges**
    - [ ] Fetch and display team badges on user profiles (`/profile`).

## Team Functionality - Phase X: Messaging Debug & Completion
- [ ] **Resolve/Re-evaluate Team Messaging (`app/teams/[slug]/page.tsx`):**
    - [ ] Current implementation has faced multiple issues (messages not displaying, errors, RLS complexities, real-time stability).
    - [ ] **Decision Point:** Stabilize current custom implementation OR investigate robust third-party/plug-and-play chat solutions compatible with Supabase/Next.js.
    - [ ] **If Stabilizing Current:**
        - [ ] Investigate why posted messages are not displayed, despite successful insertion.
        - [ ] Diagnose and fix the "Error: Failed to load messages." error.
        - [ ] **RLS Policies:**
            - [ ] Double-check `SELECT` RLS policy on `team_messages` to ensure team members can read messages.
            - [ ] Verify `SELECT` RLS policy on `profiles` allows joined data (sender's name/avatar) to be read.
        - [ ] **Data Integrity:**
            - [ ] Confirm `team_id` in `team_messages` correctly links to the `teams` table.
            - [ ] Ensure `user_team_memberships` accurately reflects user membership for the specific `team_id` being viewed.
        - [ ] **Schema & Caching:**
            - [ ] Ensure `created_at` column in `team_messages` is consistently accessible and not affected by caching.
        - [ ] **Frontend Logic:**
            - [ ] Add client-side logging in `fetchMessages` and `fetchTeamDetails` to trace `teamId` and API responses.
            - [ ] Verify real-time subscription for new messages is functioning correctly.
    - [ ] Implement "Delete Own Message" functionality (RLS was added, frontend needed).

## Authentication & Authorization
- [ ] **Additional OAuth Providers:**
    - [ ] Investigate and integrate more Supabase OAuth login options (e.g., GitHub, X.com, wallet-based logins). Prioritize those with straightforward setup.
- [ ] **Cross-Browser Auth Issues (Safari/Brave):**
    - [ ] Investigate and fix OAuth login/logout inconsistencies in Safari and Brave browsers.
    - [ ] Specifically address the issue where, after logout, re-login automatically selects the previous Google profile without prompting.

## UI & UX Improvements
- [ ] **Logout Button Relocation:** Move the "Logout" button in `UserSidebar.tsx` to a more prominent, non-scrolling position (e.g., top of the sidebar or user menu in a header).
- [ ] **Revert "My " Prefix in Menu:** Remove "My " from sidebar menu items (e.g., "My Diary" -> "Diary", "My Finances" -> "Finances") for general user clarity.
- [x] ~~**`/team` Page - Vercel-Inspired UI for Managed Project Bars:** Restyle expandable project bars with modern aesthetics (backgrounds, hover, icons, status).~~
- [x] ~~**`/team` Page - Layout Refinement:** Move "Add/Update Member" form above the team member list within expanded project bars.~~
- [x] ~~**`/team` Page - Member Display:** Use columnar/stacked layout for username and role badges.~~
- [x] ~~**`/team` Page - Drag & Drop Sortability:** Implement drag-and-drop reordering for "Managed Project" bars.~~
- [ ] **"My Projects" Page - Drag & Drop Prioritization:**
    - [ ] Implement drag-and-drop reordering for projects listed on the `/myprojects` page.
    - [ ] The order should visually signify priority/urgency ("hotness").
- [ ] **Work In Progress (WIP) Page Enhancements:**
    - [ ] **Editable Tasks:** Allow users to edit their tasks directly on the WIP page (e.g., inline editing or via a modal).
    - [ ] **Dynamic Scope Dropdown:** Ensure the "scope" dropdown for new WIP tasks populates with all projects from the current user's "My Projects" list.
    - [ ] **Visual Priority from "My Projects":** Link the project order/urgency from "My Projects" to visual cues (e.g., color-coding, highlighting) for related tasks in the WIP list.
- [ ] **Diary Entry CRUD:** Add "Edit" and "Delete" buttons/functionality to each diary entry.
- [ ] **Develop/Enhance 'My Teams' page to list user's teams and link to individual team pages.**

## Project & Task Management Flow
- [ ] **Streamline Diary -> WIP Workflow**
    - [x] ~~Analyze current diary entry process and `/workinprogress` page.~~ (Done through conversation & code review)
    - [ ] Define ideal flow for converting diary plans to actionable WIP items.
    - [ ] Implement UI/backend changes to support the new workflow (e.g., button in diary to create WIP tasks, UI for itemizing).
- [ ] **Automatic Project Listing for Team Members:** If a user is added to a project team (via `project_users`), ensure that project automatically appears on their `/myprojects` page.

## Onboarding & Signup Flow
- [ ] **Join Existing Project During Signup:** Modify the new client/user signup flow (`/signup` or similar) to allow users to select and join an *existing* project (e.g., one pre-created by an admin for them) instead of always creating a new project. This will prevent duplicate project entries like the "Robust-AE" case.

## Data Integrity & Cleanup
- [ ] **Consolidate Duplicate Client Entries:**
    - [ ] **"Robust-AE" vs "robust-ae.com":**
        - Investigate and consolidate duplicate entries for "Robust-AE" / "robust-ae.com" in the `public.clients` table.
        - Ensure the canonical entry (likely "robust-ae.com") is correctly linked in `public.project_users` for all relevant users.
        - Clean up any corresponding duplicate/incorrect entries in `public.project_scopes`.
    - [ ] **"Ninja Punk Girls" vs "ninjapunkgirls.com":**
        - Investigate and consolidate entries for "Ninja Punk Girls" / "ninjapunkgirls.com" in `public.clients` to the canonical name (likely "ninjapunkgirls.com").
        - Ensure correct linkage in `public.project_users`.
        - Clean up corresponding entries in `public.project_scopes`.
- [ ] **Align "b0ase.com Platform" as a Client Project:**
    - [ ] Ensure an entry exists in `public.clients` for "b0ase.com Platform" (or similar canonical name).
    - [ ] Ensure `richardwboase@gmail.com` is linked to this client entry in `public.project_users`.
    - [ ] Verify the existing "b0ase.com Platform" `project_scope` aligns with this client entry by name.
- [ ] **Run Project Scopes Catch-up Script:** After the above data cleanup in `clients` and `project_users`, re-run the SQL script to populate/update `public.project_scopes` to ensure consistency for the WIP dropdown.

## Planning & Admin
- [ ] **Admin Diary/WIP Population:** (For `richardwboase@gmail.com`) Review recent development and populate personal diary and WIP board with tasks and plans for "tomorrow." (Meta-task for user/AI collaboration)
- [x] ~~**AppSubNavbar Default State:** Ensure AppSubNavbar is expanded by default only on `/profile` and collapsed elsewhere, while retaining manual toggle.~~

## New Feature: Project Discovery & Bidding for Freelancers

**Core Goal:** Enable clients to make projects available for freelancers to discover and submit proposals/bids. Enable freelancers to browse these projects and submit their interest.

**Key Sub-Features & Components:**

1.  **Project Visibility Control (Client/Admin Side):**
    *   Mechanism for clients/admins to mark a project as "Open for Bids" or "Seeking Freelancers."
        *   *Integration:* New boolean column (e.g., `is_open_for_bids BOOLEAN DEFAULT FALSE`) or a status value in an enum on the `projects` table.
    *   Ability to set project-specific details relevant to bidders (e.g., required skills, budget range, application deadline).
        *   *Integration:* New optional columns on `projects` table (e.g., `required_skills TEXT[]`, `budget_min NUMERIC`, `budget_max NUMERIC`, `application_deadline TIMESTAMP`).

2.  **"Available Projects" Page (Freelancer Side):**
    *   A new page/route (e.g., `/gigs/browse` or `/projects/discover`).
        *   *Integration:* New Next.js page component.
    *   Lists projects marked as "Open for Bids."
        *   *Integration:* Fetches data from `projects` table based on the new visibility flag/status.
    *   Displays summary information: project name, brief, skills, budget (if provided), deadline.
        *   *Integration:* UI components to display project cards/list items.
    *   Filtering and Sorting: Allow freelancers to filter/sort available projects (e.g., by skill, budget, date posted).
        *   *Integration:* UI controls and modified data fetching logic.
    *   Link to a detailed project view for bidding.

3.  **Project Detail View (for Bidding Freelancers):**
    *   A specific view of a project accessible from the "Available Projects" page.
    *   Shows comprehensive project details necessary for a bid, but *hides* internal team information (chat, detailed current member list beyond client, internal tasks/comments).
        *   *Integration:* RLS policies on `projects` and related tables (like `project_members`, `project_chat` if it exists) to control what an authenticated user (who isn't yet a member of *this* project) can see if the project is open for bids.

4.  **Bidding/Application System:**
    *   Mechanism for freelancers to submit a proposal/bid.
        *   *Integration:* New table (e.g., `project_bids` or `project_applications`) linking `projects`, `users` (freelancers), and storing bid details (proposal text, proposed amount, attachments if any, submission date, status).
        *   Fields: `id`, `project_id`, `freelancer_user_id`, `proposal_text TEXT`, `bid_amount NUMERIC`, `status bid_status_enum ('Submitted', 'Viewed', 'Shortlisted', 'Accepted', 'Rejected')`, `submitted_at TIMESTAMP`.
    *   Form for bid submission on the project detail view.

5.  **Bid Management (Client Side):**
    *   Interface for clients/project owners to view bids received for their projects.
        *   *Integration:* New UI section, possibly on the existing project management page or a dedicated "Bids" tab/page for a project.
    *   Ability to review freelancer profiles, accept/reject bids.
        *   *Integration:* RLS on `project_bids` allowing project owners/clients to read bids for their projects and update status.

6.  **Notifications (Future Enhancement):**
    *   Notify clients of new bids.
    *   Notify freelancers of bid status changes.

**Architectural Integration Notes:**

*   **Database Schema:** Requires modifications to `projects` and a new `project_bids` table (and potentially a `bid_status_enum` type).
*   **RLS Policies:** Crucial for controlling visibility of projects in the discovery phase and for protecting sensitive project data from non-team members. Also for managing access to bids.
*   **Frontend:** New pages, components, and state management for browsing projects, submitting bids, and managing bids.
*   **API Endpoints (Implicit):** Supabase client will be used for all data interactions, relying on RLS for security.
*   **User Roles:**
    *   The existing `user_role_enum` (`Client`, `Freelancer`, `Admin`, `Viewer`) on `project_members` is for users *already part of a project team*.
    *   Freelancers browsing or bidding are not necessarily `project_members` of those projects yet. Their "Freelancer" status would likely come from their `profiles.role` or a similar general platform role.

## Role Management & Permissions
- [x] ~~**'Viewer' Role - DB & UI Integration:** Add 'Viewer' to `user_role_enum`, update `/team` page to save and display it.~~ (RLS policies pending)
- [ ] **RLS for 'Viewer' Role:** Define and implement Row Level Security policies for the 'Viewer' role to control what they can see and do.
- [ ] **Team Page - Granular Role Assignment:** Implement controls to prevent users (e.g., Clients) from assigning roles higher than their own or specific disallowed roles (e.g., Platform Owner). 