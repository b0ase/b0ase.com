# b0ase.com Internal API Design\n\nThis document outlines the design for an internal API for b0ase.com. This API will serve as a layer of business logic on top of the Supabase backend, providing a more abstract and LLM-friendly interface for platform operations.\n\nThe API endpoints will be built as Next.js API Routes (likely under `/app/api/v1/...` or `/app/api/internal/...`).\n\n## Guiding Principles\n\n*   **LLM-Friendly:** Endpoints should accept structured data that\'s easy for an LLM to generate and should return responses that are easy for an LLM to parse.\n*   **Business Logic Encapsulation:** Complex operations or those requiring multiple database interactions should be handled within a single API call.\n*   **Idempotency (where applicable):** Design operations to be idempotent if they might be retried.\n*   **Clear Error Handling:** Consistent error response formats.\n*   **User-Centric:** Operations are generally performed in the context of an authenticated user.\n\n## API Endpoint Ideas\n\n---\n\n### 1. User & Profile Operations\n\n*   **`GET /users/me`**\n    *   **Description:** Fetches the profile, skills, and teams for the currently authenticated user.\n    *   **Auth:** Required.\n    *   **Response:**\n        ```json\n        {\n          "id": "user-uuid",\n          "display_name": "User Name",\n          "avatar_url": "url",\n          "email": "user@example.com",\n          "skills": [{"id": "skill-uuid", "name": "Skill Name"}, ...],\n          "teams": [{"id": "team-uuid", "name": "Team Name", "slug": "team-slug", "icon_name": "icon", "color_scheme": "color"}, ...]
        }\n        ```\n\n*   **`PUT /users/me/profile`**\n    *   **Description:** Updates the profile of the currently authenticated user.\n    *   **Auth:** Required.\n    *   **Request Body:**\n        ```json\n        {\n          "display_name": "New User Name", // optional\n          "avatar_url": "new_url" // optional (or handle avatar upload separately)\n        }\n        ```\n    *   **Response:** Updated user profile object.\n\n*   **`POST /users/me/skills`**\n    *   **Description:** Adds a skill to the user\'s profile.\n    *   **Auth:** Required.\n    *   **Request Body:** `{"skill_id": "skill-uuid"}`\n    *   **Response:** Success/failure message.\n\n*   **`DELETE /users/me/skills/{skill_id}`**\n    *   **Description:** Removes a skill from the user\'s profile.\n    *   **Auth:** Required.\n    *   **Response:** Success/failure message.\n\n---\n\n### 2. Diary & Task Operations\n\n*   **`POST /diary/entries`**\n    *   **Description:** Creates a new diary entry with optional action items.\n    *   **Auth:** Required.\n    *   **Request Body:**\n        ```json\n        {\n          "title": "Diary Entry Title",\n          "summary": "Diary summary text.",\n          "action_items": ["Action Item 1 Text", "Action Item 2 Text"] // optional\n        }\n        ```\n    *   **Response:** Created diary entry object with nested action items.\n\n*   **`GET /diary/entries`**\n    *   **Description:** Lists diary entries for the user, with their action items.\n    *   **Auth:** Required.\n    *   **Query Params:** `limit`, `offset`, `date_range_start`, `date_range_end`\n    *   **Response:** Paginated list of diary entries.\n\n*   **`POST /diary/action-items/{action_item_id}/send-to-wip`**\n    *   **Description:** Sends a specific diary action item to the Work In Progress (WIP) task list.\n    *   **Auth:** Required.\n    *   **Request Body:** (Optional) `{"project_scope_id": "scope-uuid"}` if scope is known.\n    *   **Response:**\n        ```json\n        {\n          "message": "Action item sent to WIP.",\n          "wip_task_id": "new-wip-task-uuid",\n          "diary_action_item_id": "action-item-uuid",\n          "updated_action_item_status": "completed"\n        }\n        ```\n\n*   **`GET /tasks` (WIP Tasks)**\n    *   **Description:** Fetches WIP tasks for the user.\n    *   **Auth:** Required.\n    *   **Query Params:** `status`, `project_scope_id`, `due_date_start`, `due_date_end`, `sort_by`, `limit`, `offset`\n    *   **Response:** Paginated list of tasks.\n        ```json\n        // Task structure similar to DatabaseTask in app/workinprogress/page.tsx\n        {\n          "id": "task-uuid",\n          "text": "Task description",\n          "status": "TO_DO",\n          "project_scope_id": "scope-uuid", // or null\n          "project_scope_name": "Scope Name", // denormalized for convenience\n          "source_diary_action_item_id": "action-item-uuid", // or null\n          "created_at": "timestamp",\n          "updated_at": "timestamp",\n          "due_date": "date" // or null\n        }\n        ```\n\n*   **`POST /tasks` (WIP Tasks)**\n    *   **Description:** Creates a new WIP task directly.\n    *   **Auth:** Required.\n    *   **Request Body:**\n        ```json\n        {\n          "text": "New task description",\n          "status": "TO_DO", // optional, defaults to TO_DO\n          "project_scope_id": "scope-uuid" // optional\n          // other fields like due_date\n        }\n        ```\n    *   **Response:** Created task object.\n\n*   **`PUT /tasks/{task_id}` (WIP Tasks)**\n    *   **Description:** Updates a WIP task (status, scope, text, etc.).\n    *   **Auth:** Required.\n    *   **Request Body:** Partial task object with fields to update.\n    *   **Response:** Updated task object.\n\n*   **`DELETE /tasks/{task_id}` (WIP Tasks)**\n    *   **Description:** Deletes a WIP task.\n    *   **Auth:** Required.\n    *   **Response:** Success/failure message.\n\n---\n\n### 3. Team Operations\n\n*   **`GET /teams`**\n    *   **Description:** Lists teams the current user is a member of.\n    *   **Auth:** Required.\n    *   **Response:** List of team objects (id, name, slug, icon_name, color_scheme).\n\n*   **`POST /teams/join`**\n    *   **Description:** Allows user to join an existing team (e.g., by team ID or slug).\n    *   **Auth:** Required.\n    *   **Request Body:** `{"team_id": "team-uuid"}` or `{"team_slug": "team-slug"}`\n    *   **Response:** Team membership details or success/error.\n\n*   **`GET /teams/{team_id_or_slug}/messages`**\n    *   **Description:** Fetches messages for a specific team.\n    *   **Auth:** Required (user must be a member).\n    *   **Query Params:** `limit`, `before_message_id` (for pagination)\n    *   **Response:** List of message objects.\n        ```json\n        // Message structure similar to app/teams/[slug]/page.tsx\n        {\n          "id": "message-uuid",\n          "content": "Message text",\n          "created_at": "timestamp",\n          "user_id": "user-uuid",\n          "author": {\n            "display_name": "Author Name",\n            "avatar_url": "url"\n          }\n        }\n        ```\n\n*   **`POST /teams/{team_id_or_slug}/messages`**\n    *   **Description:** Posts a new message to a team.\n    *   **Auth:** Required (user must be a member).\n    *   **Request Body:** `{"content": "New message text"}`\n    *   **Response:** Created message object.\n\n---\n\n### 4. Project Operations (Clients)\n\n*   **`GET /projects`**\n    *   **Description:** Lists client projects associated with the user.\n    *   **Auth:** Required.\n    *   **Response:** List of project objects (id, name).\n\n*   **`POST /projects/{project_id}/members/invite`** (Placeholder - invitation form is disabled)\n    *   **Description:** Invites a new member to a project.\n    *   **Auth:** Required (user must have permissions).\n    *   **Request Body:** `{"email_to_invite": "invitee@example.com", "role": "editor"}`\n    *   **Response:** Invitation status.\n\n---\n\n### 5. Project Scopes\n\n*   **`GET /project-scopes`**\n    *   **Description:** Lists all available project scopes for the user (combining user\'s clients and their general scopes).\n    *   **Auth:** Required.\n    *   **Response:** List of scope objects `{"id": "scope-uuid", "name": "Scope Name"}`.\n\n*   **`POST /project-scopes`**\n    *   **Description:** Creates a new general project scope for the user.\n    *   **Auth:** Required.\n    *   **Request Body:** `{"name": "New Scope Name", "description": "Optional description"}`\n    *   **Response:** Created scope object. 